<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Rastreio de Depressão (PHQ-9)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      @font-face {
        font-display: block; font-family: Roboto;
        src: url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/7529907e9eaf8ebb5220c5f9850e3811.woff2) format("woff2"), url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/25c678feafdc175a70922a116c9be3e7.woff) format("woff")
      }
      #sib-container a { text-decoration: underline; color: #2BB2FC; }
    </style>
    <link rel="stylesheet" href="https://sibforms.com/forms/end-form/build/sib-styles.css">
    <style>
        :root {
            --primary-color: #4a69bd; --primary-darker: #3c56a0; --light-bg: #f7f9fc; --text-color: #333; --light-text: #666; --border-color-light: #eef2f7; --card-shadow: 0 4px 12px rgba(0,0,0,0.08); --subtle-shadow: 0 2px 5px rgba(0,0,0,0.07);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', 'Segoe UI', sans-serif; background-color: var(--light-bg); color: var(--text-color); line-height: 1.6; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 20px; }
        .header { background: white; padding: 40px; border-radius: 16px; box-shadow: var(--card-shadow); margin-bottom: 30px; text-align: center; }
        .header h1 { color: var(--primary-color); font-size: 1.8em; font-weight: 700; }
        .header h2 { color: var(--light-text); font-size: 1.1em; font-weight: 400; }
        .instructions { background: #eaf0ff; padding: 20px; border-radius: 12px; margin-top: 20px; border-left: 5px solid var(--primary-color); }
        .floating-progress { position: fixed; bottom: 30px; right: 30px; background: white; border-radius: 50%; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 10px; z-index: 1000; transition: all 0.3s ease; }
        .floating-progress:hover { transform: scale(1.05); }
        .progress-circle { position: relative; display: flex; align-items: center; justify-content: center; }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-fill { stroke-dasharray: 157.08; stroke-dashoffset: 157.08; transition: stroke-dashoffset 0.5s ease; stroke-linecap: round; }
        .progress-number { position: absolute; font-size: 16px; font-weight: bold; color: var(--primary-color); }
        .progress-label { text-align: center; font-size: 10px; color: var(--light-text); margin-top: -5px; font-weight: 500; }
        .scale-section { background: white; padding: 30px; border-radius: 16px; box-shadow: var(--card-shadow); margin-bottom: 30px; }
        .question { padding: 20px 0; border-bottom: 1px solid var(--border-color-light); }
        .question:last-child { border-bottom: none; }
        .question-text { font-weight: 600; margin-bottom: 15px; font-size: 1em; }
        .radio-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
        .radio-option { padding: 10px; text-align: center; background: white; border: 2px solid white; box-shadow: var(--subtle-shadow); border-radius: 8px; cursor: pointer; transition: all 0.2s ease; font-weight: 500; font-size: 16px; }
        .radio-option:hover { border-color: var(--primary-color); }
        .radio-option.selected { background-color: var(--primary-color); border-color: var(--primary-color); font-weight: 600; color: white; box-shadow: none; }
        .buttons { text-align: center; margin: 40px 0; }
        .btn { padding: 14px 28px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease; }
        .btn:hover { background: var(--primary-darker); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .results-section { display: none; background: white; padding: 30px; border-radius: 16px; box-shadow: var(--card-shadow); margin-top: 30px; }
        .results-header h3 { color: var(--primary-darker); text-align: center; font-size: 1.8em; margin-bottom: 25px; }
        .interpretation-box { padding: 20px; border-radius: 12px; margin-top: 20px; font-weight: 500; border-left: 5px solid; }
        .minimal { background: #e6f7eb; border-left-color: #52c41a; color: #135200; }
        .leve { background: #fffbe6; border-left-color: #faad14; color: #874d00; }
        .moderada { background: #fff3e0; border-left-color: #ff9800; color: #b85d00; }
        .moderadamente_grave { background: #ffcdd2; border-left-color: #f44336; color: #c62828; }
        .grave { background: #d1c4e9; border-left-color: #673ab7; color: #311b92; }
        .alert { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 8px; margin-top: 15px; font-weight: bold; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-container { background-color: #f6faff; border-radius: 10px; width: 90%; max-width: 540px; transform: scale(0.9); transition: transform 0.3s ease; padding-bottom: 20px; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-overlay.show .modal-container { transform: scale(1); }
        #sib-form-container button { font-family: 'Nunito', sans-serif !important; }
        .sib-form-block:has(> .sib-form-block__button) { text-align: center !important; }
        @media (max-width: 768px) {
            .container { margin: 0; padding: 0; width: 100%; } .header, .scale-section, .results-section { padding: 25px 15px; border-radius: 0; margin: 0 0 10px 0; width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>Teste de Rastreio de Depressão</h1><h2>Escala PHQ-9</h2><div class="instructions"><strong>Instrução:</strong> Durante as <strong>últimas 2 semanas</strong>, com que frequência você foi incomodado(a) por qualquer um dos problemas abaixo?</div></div>
        <div id="phq9-form-container"></div>
        <div class="buttons"><button class="btn" onclick="handleResultClick()">Ver Resultado</button></div>
        <div class="results-section" id="results"><div class="results-header"><h3>Resultados do Teste PHQ-9</h3></div><div class="result-item"><div class="result-label">Pontuação Total</div><div class="result-value" id="totalScore">-- / 27</div></div><div id="interpretation"></div><div class="buttons"><button class="btn" id="pdfBtn" onclick="generatePDF()" style="display:none;">Gerar Relatório Profissional</button></div></div>
    </div>
    <div class="floating-progress" id="floatingProgress" style="display: none;"><div class="progress-circle"><svg class="progress-ring" width="60" height="60"><circle class="progress-ring-bg" cx="30" cy="30" r="25" fill="none" stroke="#e0e0e0" stroke-width="5"/><circle class="progress-ring-fill" cx="30" cy="30" r="25" fill="none" stroke="var(--primary-color)" stroke-width="5" id="progressRing"/></svg><div class="progress-number" id="progressNumber">0</div></div><div class="progress-label">itens</div></div>

    <div id="brevoModal" class="modal-overlay">
        <div class="modal-container">
            <div id="brevo-form-placeholder">
                <div class="sib-form" style="text-align: center;"><div id="sib-form-container" class="sib-form-container"><div id="error-message" class="sib-form-message-panel" style="font-size:16px; text-align:left; font-family:Helvetica, sans-serif; color:#661d1d; background-color:#ffeded; border-radius:3px; border-color:#ff4949;max-width:540px;"><div class="sib-form-message-panel__text sib-form-message-panel__text--center"><svg viewBox="0 0 512 512" class="sib-icon sib-notification__icon"><path d="M256 40c118.621 0 216 96.075 216 216 0 119.291-96.61 216-216 216-119.244 0-216-96.562-216-216 0-119.203 96.602-216 216-216m0-32C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm-11.49 120h22.979c6.823 0 12.274 5.682 11.99 12.5l-7 168c-.268 6.428-5.556 11.5-11.99 11.5h-8.979c-6.433 0-11.722-5.073-11.99-11.5l-7-168c-.283-6.818 5.167-12.5 11.99-12.5zM256 340c-15.464 0-28 12.536-28 28s12.536 28 28 28 28-12.536 28-28-12.536-28-28-28z" /></svg><span class="sib-form-message-panel__inner-text">Seu cadastro não pôde ser validada. Tente novamente.</span></div></div><div></div><div id="success-message" class="sib-form-message-panel" style="font-size:16px; text-align:left; font-family:Helvetica, sans-serif; color:#085229; background-color:#e7faf0; border-radius:3px; border-color:#13ce66;max-width:540px;"><div class="sib-form-message-panel__text sib-form-message-panel__text--center"><svg viewBox="0 0 512 512" class="sib-icon sib-notification__icon"><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z" /></svg><span class="sib-form-message-panel__inner-text">Você fez seu cadastro com sucesso. Conclua o teste.</span></div></div><div></div><div id="sib-container" class="sib-container--large sib-container--vertical" style="text-align:center; background-color:rgba(255,255,255,1); max-width:540px; border-radius:10px; border-width:1px; border-color:#C0CCD9; border-style:solid; direction:ltr"><form id="sib-form" method="POST" action="https://19d89fa0.sibforms.com/serve/MUIFAAdcYwFy052VwffZJiB8AerRBPXvLLusaejGVlidw9k1FoSg0VVThGeHs9JJHWnEygYLYcyrqCUWd-NugCJxSE-KkBJ-xXVfzyBXxJfKeeDO-PywjNEpfs2angfv4k-pBXV316dLQDTYVRRlfGiKQM6-H7CEEOySKSBPsEaX-dVNr1dNV98N3skZidMWpIdDf111zwr8cS_1" data-type="subscription"><div style="padding: 8px 0;"><div class="sib-form-block" style="font-size:32px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent; text-align:left"><p><strong>Cadastre-se para finalizar o teste</strong></p></div></div><div style="padding: 8px 0;"><div class="sib-form-block" style="font-size:16px; text-align:left; font-family:Helvetica, sans-serif; color:#3C4858; background-color:transparent; text-align:left"><div class="sib-text-form-block"><p><strong>Relatório personalizado gerado automaticamente.</strong></p></div></div></div><div style="padding: 8px 0;"><div class="sib-input sib-form-block"><div class="form__entry entry_block"><div class="form__label-row "><label class="entry__label" style="font-weight: 700; text-align:left; font-size:16px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3c4858;" for="FIRSTNAME">Nome completo</label><div class="entry__field"><input class="input " maxlength="200" type="text" id="FIRSTNAME" name="FIRSTNAME" autocomplete="off" placeholder="Insira seu nome" /></div></div><label class="entry__error entry__error--primary"></label></div></div></div><div style="padding: 8px 0;"><div class="sib-input sib-form-block"><div class="form__entry entry_block"><div class="form__label-row "><label class="entry__label" style="font-weight: 700; text-align:left; font-size:16px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3c4858;" for="EMAIL" data-required="*">E-mail</label><div class="entry__field"><input class="input " type="text" id="EMAIL" name="EMAIL" autocomplete="off" placeholder="Insira seu email" data-required="true" required /></div></div><label class="entry__error entry__error--primary"></label><label class="entry__specification" style="font-size:12px; text-align:left; font-family:Helvetica, sans-serif; color:#8390A4; text-align:left">Forneça seu e-mail cadastro. Por exemplo: abc@xyz.com</label></div></div></div><div style="padding: 8px 0;"><div class="sib-sms-field sib-form-block"><div class="form__entry entry_block"><div class="form__label-row "><label class="entry__label" style="font-weight: 700; text-align:left; font-size:16px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#3c4858;" for="SMS" data-required="*">Celular</label><div class="sib-sms-input-wrapper" style="direction:ltr"><div class="sib-sms-input" data-placeholder="Celular com DDD" data-required="1" data-country-code="BR"><div class="entry__field"><select class="input" name="SMS__COUNTRY_CODE" data-required="true"><option value="+55"> +55 BR </option></select></div><div class="entry__field" style="width: 100%"><input type="tel" class="input" id="SMS" name="SMS" autocomplete="off" placeholder="Celular com DDD" data-required="true" required /></div></div></div></div><label class="entry__error entry__error--primary"></label></div></div></div><div style="padding: 8px 0;"><div class="sib-form-block" style="text-align: left"><button class="sib-form-block__button sib-form-block__button-with-loader" style="font-size:16px; text-align:left; font-weight:700; font-family:Helvetica, sans-serif; color:#FFFFFF; background-color:#1949b3; border-radius:6px; border-width:0px;" form="sib-form" type="submit"><svg class="icon clickable__icon progress-indicator__icon sib-hide-loader-icon" viewBox="0 0 512 512"><path d="M460.116 373.846l-20.823-12.022c-5.541-3.199-7.54-10.159-4.663-15.874 30.137-59.886 28.343-131.652-5.386-189.946-33.641-58.394-94.896-95.833-161.827-99.676C261.028 55.961 256 50.751 256 44.352V20.309c0-6.904 5.808-12.337 12.703-11.982 83.556 4.306 160.163 50.864 202.11 123.677 42.063 72.696 44.079 162.316 6.031 236.832-3.14 6.148-10.75 8.461-16.728 5.01z" /></svg>VER RESULTADO</button></div></div><input type="text" name="email_address_check" value="" class="input--hidden"><input type="hidden" name="locale" value="pt"></form></div></div></div>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" onclick="handleAlreadyRegistered(event)" style="font-family: 'Nunito', sans-serif; color: #666; font-size: 14px; text-decoration: underline;">
                    Já é cadastrado? Clique aqui.
                </a>
            </div>
        </div>
    </div>

    <script>
        const phq9Items = [ { id: 'q1', text: '1. Pouco interesse ou pouco prazer em fazer as coisas' }, { id: 'q2', text: '2. Se sentir "para baixo", deprimido(a) ou sem perspectiva' }, { id: 'q3', text: '3. Dificuldade para pegar no sono ou permanecer dormindo, ou dormir mais do que de costume' }, { id: 'q4', text: '4. Se sentir cansado(a) ou com pouca energia' }, { id: 'q5', text: '5. Falta de apetite ou comendo demais' }, { id: 'q6', text: '6. Se sentir mal consigo mesmo(a) — ou achar que você é um fracasso ou que decepcionou sua família ou você mesmo(a)' }, { id: 'q7', text: '7. Dificuldade para se concentrar nas coisas, como ler o jornal ou ver televisão' }, { id: 'q8', text: '8. Lentidão para se movimentar ou falar, a ponto das outras pessoas perceberem? Ou o oposto – estar tão agitado(a) ou irrequieto(a) que você fica andando de um lado para o outro muito mais do que de costume' }, { id: 'q9', text: '9. Pensar em se ferir de alguma maneira ou que seria melhor estar morto(a)' }, { id: 'q10_difficulty', text: '10. Se você assinalou qualquer um dos problemas, indique o grau de dificuldade que os mesmos lhe causaram para realizar seu trabalho, tomar conta das coisas em casa ou para se relacionar com as pessoas:'} ];
        const phq9Options = [ { text: 'Nenhuma vez', value: 0 }, { text: 'Vários dias', value: 1 }, { text: 'Mais da metade dos dias', value: 2 }, { text: 'Quase todos os dias', value: 3 } ];
        const difficultyOptions = ['Nenhuma dificuldade', 'Alguma dificuldade', 'Muita dificuldade', 'Extrema dificuldade'];

        document.addEventListener('DOMContentLoaded', () => {
            const formContainer = document.getElementById('phq9-form-container'); const mainSection = document.createElement('div'); mainSection.className = 'scale-section'; phq9Items.slice(0, 9).forEach(item => { const qDiv = document.createElement('div'); qDiv.className = 'question'; qDiv.innerHTML = `<div class="question-text">${item.text}</div>`; const group = document.createElement('div'); group.className = 'radio-group'; group.id = item.id; phq9Options.forEach(opt => { const optionDiv = document.createElement('div'); optionDiv.className = 'radio-option'; optionDiv.textContent = opt.text; optionDiv.dataset.value = opt.value; optionDiv.onclick = () => { group.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected')); optionDiv.classList.add('selected'); updateProgress(); }; group.appendChild(optionDiv); }); qDiv.appendChild(group); mainSection.appendChild(qDiv); }); formContainer.appendChild(mainSection); const difficultySection = document.createElement('div'); difficultySection.className = 'scale-section'; const diffItem = phq9Items[9]; difficultySection.innerHTML = `<h3>${diffItem.text}</h3>`; const diffGroup = document.createElement('div'); diffGroup.className = 'radio-group'; diffGroup.id = diffItem.id; difficultyOptions.forEach(opt => { const optionDiv = document.createElement('div'); optionDiv.className = 'radio-option'; optionDiv.textContent = opt; optionDiv.dataset.value = opt; optionDiv.onclick = () => { diffGroup.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected')); optionDiv.classList.add('selected'); updateProgress(); }; diffGroup.appendChild(optionDiv); }); difficultySection.appendChild(diffGroup); formContainer.appendChild(difficultySection);
            setupBrevoObserver();
        });
        
        function updateProgress() {
            const total = phq9Items.length;
            const answered = document.querySelectorAll('.radio-option.selected').length;
            const percentage = Math.round((answered / total) * 100);
            const progressRing = document.getElementById('progressRing');
            const circumference = 2 * Math.PI * 25;
            const offset = circumference - (percentage / 100 * circumference);
            progressRing.style.strokeDashoffset = offset;
            document.getElementById('progressNumber').textContent = answered;
            document.getElementById('floatingProgress').style.display = answered > 0 ? 'block' : 'none';
        }
        
        function handleResultClick() { if (document.querySelectorAll('.radio-option.selected').length < phq9Items.length) { alert(`Por favor, responda todos os ${phq9Items.length} itens da escala.`); return; } if (localStorage.getItem('brevoFormSubmitted') === 'true') { showResults(); } else { showBrevoModal(); } }
        function showBrevoModal() { document.getElementById('brevoModal').classList.add('show'); }
        function setupBrevoObserver() { const targetNode = document.getElementById('brevo-form-placeholder'); if (!targetNode) return; const observer = new MutationObserver(() => { const successMessageDiv = document.getElementById('success-message'); if (successMessageDiv && successMessageDiv.offsetParent !== null) { localStorage.setItem('brevoFormSubmitted', 'true'); setTimeout(() => { document.getElementById('brevoModal').classList.remove('show'); showResults(); }, 2000); observer.disconnect(); } }); observer.observe(targetNode, { childList: true, subtree: true }); }
        function handleAlreadyRegistered(event) { event.preventDefault(); localStorage.setItem('brevoFormSubmitted', 'true'); document.getElementById('brevoModal').classList.remove('show'); showResults(); }
        function showResults() { let totalScore = 0; const responses = {}; phq9Items.slice(0,9).forEach(item => { const selected = document.querySelector(`#${item.id} .selected`); const score = selected ? parseInt(selected.dataset.value) : 0; totalScore += score; responses[item.id] = score; }); const interpretation = getInterpretation(totalScore); document.getElementById('totalScore').textContent = `${totalScore} / 27`; const interpretationDiv = document.getElementById('interpretation'); interpretationDiv.innerHTML = `<div class="interpretation-box ${interpretation.classe}"><h4>${interpretation.nivel}</h4><p>${interpretation.descricao}</p></div>`; if (responses['q9'] > 0) { interpretationDiv.innerHTML += `<div class="alert"><strong>ATENÇÃO:</strong> Foi indicada a presença de pensamentos de autolesão. É essencial procurar ajuda profissional imediatamente.</div>`; } const resultsSection = document.getElementById('results'); resultsSection.style.display = 'block'; document.getElementById('pdfBtn').style.display = 'inline-block'; resultsSection.scrollIntoView({ behavior: 'smooth' }); }
        function getInterpretation(score) { if (score <= 4) return { nivel: 'SINTOMAS MÍNIMOS', classe: 'minimal', descricao: 'Sua pontuação sugere ausência ou presença mínima de sintomas depressivos.' }; if (score <= 9) return { nivel: 'DEPRESSÃO LEVE', classe: 'leve', descricao: 'Sua pontuação sugere sintomas depressivos leves. Monitorar o humor e autocuidado são recomendados.' }; if (score <= 14) return { nivel: 'DEPRESSÃO MODERADA', classe: 'moderada', descricao: 'Sua pontuação sugere sintomas depressivos moderados. É aconselhável discutir estes resultados com um profissional.' }; if (score <= 19) return { nivel: 'DEPRESSÃO MODERADAMENTE GRAVE', classe: 'moderadamente_grave', descricao: 'Sua pontuação sugere sintomas depressivos moderadamente graves. A busca por avaliação e tratamento profissional é importante.' }; return { nivel: 'DEPRESSÃO GRAVE', classe: 'grave', descricao: 'Sua pontuação sugere sintomas depressivos graves. É fundamental procurar ajuda profissional imediata.' }; }
        async function generatePDF() { const patientName = prompt("Por favor, digite o nome completo para o relatório:", "Nome do Paciente"); if (!patientName) return; const { jsPDF } = window.jspdf; const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' }); const logoUrl = 'https://transtornobipolar.net/wp-content/uploads/2025/09/Logo@4x.png'; let logoBase64 = ''; try { const response = await fetch(logoUrl); const blob = await response.blob(); const reader = new FileReader(); logoBase64 = await new Promise(resolve => { reader.onloadend = () => resolve(reader.result); reader.readAsDataURL(blob); }); } catch (error) { console.error("Erro ao carregar o logotipo:", error); } const today = new Date().toLocaleDateString('pt-BR'); const primaryColor = '#4a69bd'; const margin = 15, pageWidth = 210, pageHeight = 297; let yPos = 0, page = 1; const drawHeader = () => { const headerHeight = 30; doc.setFillColor(primaryColor); doc.rect(0, 0, pageWidth, headerHeight, 'F'); doc.setFontSize(18); doc.setFont('helvetica', 'bold'); doc.setTextColor('#FFFFFF'); doc.text('Relatório de Rastreio de Depressão (PHQ-9)', margin, 18); if (logoBase64) { const logoWidth = 35, logoHeight = 9.2; doc.addImage(logoBase64, 'PNG', pageWidth - margin - logoWidth, (headerHeight - logoHeight) / 2, logoWidth, logoHeight); } yPos = headerHeight + 10; }; const drawFooter = () => { doc.setFontSize(9); doc.setFont('helvetica', 'normal'); doc.setTextColor('#6c757d'); doc.text(`Relatório de ${patientName} | Gerado em ${today} | Página ${page}`, pageWidth / 2, pageHeight - 10, { align: 'center' }); }; const drawSectionTitle = (title) => { if (yPos > pageHeight - 35) { drawFooter(); doc.addPage(); page++; drawHeader(); } doc.setFontSize(14); doc.setFont('helvetica', 'bold'); doc.setTextColor(primaryColor); doc.text(title, margin, yPos); yPos += 8; }; const drawScoreGauge = (score, maxScore) => { const percentage = score / maxScore; let scoreColor = '#27ae60'; if (percentage >= (5/27)) scoreColor = '#f39c12'; if (percentage >= (10/27)) scoreColor = '#e67e22'; if (percentage >= (20/27)) scoreColor = '#c0392b'; doc.setFontSize(12); doc.setFont('helvetica', 'bold'); doc.setTextColor('#333'); doc.text('Pontuação Total PHQ-9:', margin, yPos + 7); const gaugeWidth = 80; const gaugeX = pageWidth - margin - gaugeWidth; const fillWidth = percentage * gaugeWidth; doc.setFillColor('#EAECEE'); doc.roundedRect(gaugeX, yPos, gaugeWidth, 10, 5, 5, 'F'); doc.setFillColor(scoreColor); doc.roundedRect(gaugeX, yPos, fillWidth, 10, 5, 5, 'F'); doc.setTextColor(scoreColor); doc.text(`${score}/${maxScore}`, gaugeX - 12, yPos + 7.5); yPos += 20; }; const drawTable = (data) => { const colWidths = [120, 60]; let isEven = false; const drawTableHeader = () => { doc.setFillColor("#f1f3f5"); doc.rect(margin, yPos, colWidths.reduce((a, b) => a + b), 8, 'F'); doc.setFontSize(10); doc.setFont('helvetica', 'bold'); doc.setTextColor('#333'); doc.text('Item Avaliado', margin + 2, yPos + 6); doc.text('Resposta e Pontuação', margin + colWidths[0] + 2, yPos + 6); yPos += 8; }; drawTableHeader(); data.forEach(row => { const qLines = doc.splitTextToSize(row.question, colWidths[0] - 4); const aLines = doc.splitTextToSize(row.answer, colWidths[1] - 4); const rowHeight = Math.max(qLines.length, aLines.length) * 5 + 4; if (yPos + rowHeight > pageHeight - 20) { drawFooter(); doc.addPage(); page++; drawHeader(); drawSectionTitle('Respostas Detalhadas (continuação)'); drawTableHeader(); } if (isEven) { doc.setFillColor("#f8f9fa"); doc.rect(margin, yPos, colWidths.reduce((a, b) => a + b), rowHeight, 'F'); } doc.setTextColor('#333'); doc.setFont('helvetica', 'normal'); doc.text(qLines, margin + 2, yPos + 5); doc.setFont('helvetica', 'bold'); doc.text(aLines, margin + colWidths[0] + 2, yPos + 5); yPos += rowHeight; isEven = !isEven; }); }; let totalScore = 0; const responses = {}; const tableData = []; phq9Items.slice(0, 9).forEach(item => { const selected = document.querySelector(`#${item.id} .selected`); const score = selected ? parseInt(selected.dataset.value) : 0; const text = selected ? selected.textContent : 'Não respondido'; totalScore += score; responses[item.id] = score; tableData.push({ question: item.text, answer: `${text} (${score} pts)`}); }); const difficultySelected = document.querySelector(`#${phq9Items[9].id} .selected`); const difficultyText = difficultySelected ? difficultySelected.dataset.value : 'Não respondido'; tableData.push({ question: phq9Items[9].text, answer: difficultyText }); const interpretation = getInterpretation(totalScore); drawHeader(); drawSectionTitle('Resumo da Avaliação'); drawScoreGauge(totalScore, 27); const addText = (text, options = {}) => { doc.setFontSize(options.size || 10); doc.setFont('helvetica', options.style || 'normal'); const splitText = doc.splitTextToSize(text, pageWidth - (margin * 2)); doc.text(splitText, margin, yPos); yPos += (splitText.length * 5) + (options.spacing || 2); }; addText(`Classificação: ${interpretation.nivel}`, { style: 'bold', size: 11 }); addText(interpretation.descricao); yPos += 5; if (responses['q9'] > 0) { doc.setFillColor(248, 215, 218); doc.rect(margin, yPos, pageWidth - (margin * 2), 15, 'F'); doc.setFontSize(11); doc.setFont('helvetica', 'bold'); doc.setTextColor(114, 28, 36); doc.text('⚠️ ALERTA: Pensamentos de autolesão foram relatados (Item 9).', margin + 2, yPos + 9); yPos += 20; } drawSectionTitle('Respostas Detalhadas'); drawTable(tableData); drawFooter(); doc.save(`PHQ-9_Relatorio_${patientName.replace(/ /g, '_')}_${today}.pdf`); }
    </script>

    <script>
      window.REQUIRED_CODE_ERROR_MESSAGE = 'Escolha um código de país'; window.LOCALE = 'pt'; window.EMAIL_INVALID_MESSAGE = window.SMS_INVALID_MESSAGE = "A informação fornecida não é valida. Verifique o formato do campo e tente novamente."; window.REQUIRED_ERROR_MESSAGE = "Este campo não pode ser deixado em branco. "; window.GENERIC_INVALID_MESSAGE = "A informação fornecida não é valida. Verifique o formato do campo e tente novamente."; window.translation = { common: { selectedList: '{quantity} lista selecionada' } };
      var AUTOHIDE = Boolean(1);
    </script>
    <script defer src="https://sibforms.com/forms/end-form/build/main.js"></script>
</body>
</html>
